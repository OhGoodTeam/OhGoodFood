<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.ohgoodfood.dao.StoreMapper">

	<select id="login" parameterType="kr.co.ohgoodfood.dto.Store" resultType="kr.co.ohgoodfood.dto.Store">
		SELECT * FROM Store WHERE store_id=#{store_id} AND store_pwd=#{store_pwd}
	</select>
		
	<!-- 아이디 중복확인 -->
	<select id="findById" parameterType="String" resultType="kr.co.ohgoodfood.dto.Store">
		SELECT * FROM Store WHERE store_id = #{value}
	</select>
	
	<!--회원가입-->
	<insert id="insert" parameterType="kr.co.ohgoodfood.dto.Store">
		INSERT INTO Store (
		store_id, confirmed, business_number, store_address, store_name,
		store_menu,
		store_explain, store_telnumber, store_status, opened_at, closed_at,
		store_pwd,
		owner_name, category_bakery, category_fruit, category_salad,
		category_others, latitude, longitude
		) VALUES (
		#{store_id}, #{confirmed}, #{business_number}, #{store_address},
		#{store_name},
		#{store_menu}, #{store_explain}, #{store_telnumber}, #{store_status},
		#{opened_at}, #{closed_at}, #{store_pwd}, #{owner_name},
		#{category_bakery}, #{category_fruit}, #{category_salad},
		#{category_others}, #{latitude}, #{longitude}
		)
	</insert>
	
	<!--회원가입 시 이미지 넣기-->
	<insert id="insertImage" parameterType="kr.co.ohgoodfood.dto.Image">
		INSERT INTO Image (store_id, store_img)
		VALUES (#{store_id}, #{store_img})
	</insert>
	
	<!--이미지 가져오기 -->
	<select id="findImagesByStoreId" parameterType="string" resultType="kr.co.ohgoodfood.dto.Image">
    	SELECT * FROM Image WHERE store_id = #{store_id}
	</select>


	<select id="findProductByStoreId" parameterType="string" resultType="kr.co.ohgoodfood.dto.Product">
	    SELECT * FROM Product WHERE store_id = #{store_id} LIMIT 1
	</select>
	
	<!-- 오픈/마감 상태 변경 -->
	<update id="updateStoreStatus">
	    UPDATE Store
	    SET store_status = #{status}
	    WHERE store_id = #{store_id}
	</update>

	<!--마이페이지 수정-->
	<update id="updateStore" parameterType="kr.co.ohgoodfood.dto.Store">
		UPDATE Store
		SET
		opened_at = #{opened_at},
		closed_at = #{closed_at},
		category_bakery = #{category_bakery},
		category_salad = #{category_salad},
		category_fruit = #{category_fruit},
		category_others = #{category_others},
		store_menu = #{store_menu},
		store_explain = #{store_explain}
		WHERE store_id = #{store_id}
	</update>
</mapper>
